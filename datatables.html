import os
import subprocess

# 1. THE HTML CONTENT (Built to your exact specs)
html_content = """<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DataTables Management</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css" rel="stylesheet">
    
    <style>
        body { background-color: #f4f7f6; padding: 2rem; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .container-card { background: white; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); padding: 20px; }
        
        /* 3. Layout: Page navigation in top middle */
        .top-center-paging .dataTables_paginate {
            display: flex;
            justify-content: center;
            float: none !important;
            margin-bottom: 20px;
        }

        /* 3. Layout: Entries and Info in lower left, stacked */
        .bottom-left-stack {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            margin-top: 15px;
        }
        
        /* 5. Show/Hide Buttons */
        .col-toggle-btn { margin-right: 5px; margin-bottom: 5px; font-size: 0.8rem; }
        
        /* 4. Column Search Styling */
        thead input {
            width: 100%;
            padding: 3px;
            box-sizing: border-box;
            font-size: 0.8rem;
        }
        
        .selected-row { background-color: #e2f0ff !important; }
        .tab-pane { padding-top: 20px; }
    </style>
</head>
<body>

<div class="container-fluid container-card">
    <h2 class="mb-4 text-center">CV Inventory Management</h2>

    <ul class="nav nav-tabs" id="tableTabs" role="tablist">
        <li class="nav-item">
            <button class="nav-link active" id="primary-tab" data-bs-toggle="tab" data-bs-target="#tab1" type="button">Primary Database</button>
        </li>
        <li class="nav-item">
            <button class="nav-link" id="secondary-tab" data-bs-toggle="tab" data-bs-target="#tab2" type="button">Archive Database</button>
        </li>
    </ul>

    <div class="tab-content">
        <div class="tab-pane fade show active" id="tab1">
            <div id="colVis1" class="mb-3"><strong>Toggle Columns: </strong></div>
            <table id="example1" class="table table-striped table-bordered w-100">
                <thead>
                    <tr>
                        <th>Select</th>
                        <th>Name</th>
                        <th>Position</th>
                        <th>Office</th>
                        <th>Age</th>
                        <th>Salary</th>
                    </tr>
                </thead>
            </table>
            <button id="delBtn1" class="btn btn-danger btn-sm mt-2">Delete Selected Rows</button>
        </div>

        <div class="tab-pane fade" id="tab2">
            <div id="colVis2" class="mb-3"><strong>Toggle Columns: </strong></div>
            <table id="example2" class="table table-striped table-bordered w-100">
                <thead>
                    <tr>
                        <th>Select</th>
                        <th>Name</th>
                        <th>Position</th>
                        <th>Office</th>
                        <th>Age</th>
                        <th>Salary</th>
                    </tr>
                </thead>
            </table>
            <button id="delBtn2" class="btn btn-danger btn-sm mt-2">Delete Selected Rows</button>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>

<script>
const dataSet = [
    [null, "Tiger Nixon", "System Architect", "Edinburgh", "61", "$320,800"],
    [null, "Garrett Winters", "Accountant", "Tokyo", "63", "$170,750"],
    [null, "Ashton Cox", "Junior Technical Author", "San Francisco", "66", "$86,000"],
    [null, "Cedric Kelly", "Senior Javascript Developer", "Edinburgh", "22", "$433,060"],
    [null, "Airi Satou", "Accountant", "Tokyo", "33", "$162,700"]
];

function setupTable(tableId, colVisId, delBtnId) {
    // 4. Add Individual Column Searching
    $(`${tableId} thead tr`).clone(true).addClass('filters').appendTo(`${tableId} thead`);

    const table = $(tableId).DataTable({
        data: dataSet,
        orderCellsTop: true,
        // 3. Layout logic: Paging top (p), Table (t), Length/Info bottom (li)
        dom: '<"top-center-paging"p>t<"bottom-left-stack"li>',
        columnDefs: [{
            targets: 0,
            orderable: false,
            className: 'select-checkbox',
            render: function() { return '<input type="checkbox" class="row-select">'; }
        }],
        initComplete: function() {
            const api = this.api();
            // Setup Search Inputs
            $(`${tableId} thead tr.filters th`).each(function(i) {
                if (i == 0) { $(this).html(''); return; }
                $(this).html('<input type="text" placeholder="Search..." />');
                $('input', this).on('keyup change', function() {
                    if (api.column(i).search() !== this.value) {
                        api.column(i).search(this.value).draw();
                    }
                });
            });

            // 5. Show / Hide Columns logic
            api.columns().every(function(i) {
                if (i == 0) return;
                let title = api.column(i).header().textContent;
                $('<button class="btn btn-outline-secondary btn-sm col-toggle-btn active">' + title + '</button>')
                    .appendTo(colVisId)
                    .on('click', function() {
                        let column = api.column(i);
                        column.visible(!column.visible());
                        $(this).toggleClass('active');
                    });
            });
        }
    });

    // 3. Select and Delete logic
    $(tableId + ' tbody').on('click', 'input.row-select', function() {
        $(this).closest('tr').toggleClass('selected-row');
    });

    $(delBtnId).click(function() {
        table.rows('.selected-row').remove().draw();
    });
}

$(document).ready(function() {
    setupTable('#example1', '#colVis1', '#delBtn1');
    setupTable('#example2', '#colVis2', '#delBtn2');
    
    // Fix for DataTables in tabs
    $('button[data-bs-toggle="tab"]').on('shown.bs.tab', function () {
        $.fn.dataTable.tables({ visible: true, api: true }).columns.adjust();
    });
});
</script>
</body>
</html>"""

# WRITE FILE
file_name = "datatables.html"
with open(file_name, "w") as f:
    f.write(html_content)
print(f"Created {file_name} locally.")

# 2. PUSH TO REMOTE REPOSITORY
def run_command(cmd):
    return subprocess.run(cmd, shell=True, capture_output=True, text=True)

print("Starting Git Push...")
run_command("git add datatables.html")
run_command('git commit -m "Update datatables.html with merged functionality"')
push_res = run_command("git push")

if push_res.returncode == 0:
    print("Successfully pushed to remote repository.")
else:
    print("Push failed. Error:", push_res.stderr)

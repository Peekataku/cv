<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DataTables Custom Layout - Final</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css" rel="stylesheet">
    
    <style>
        body {
            background-color: #f8f9fa;
            font-family: "Segoe UI", system-ui, -apple-system, sans-serif;
            padding: 2rem;
        }

        .main-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            border: none;
            overflow: hidden;
        }

        .card-header-custom {
            background-color: #fff;
            border-bottom: 1px solid #eee;
            padding: 1.5rem 2rem 0;
        }

        .tab-content { padding: 2rem; }

        /* Controls Section */
        .controls-section {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 1px solid #e9ecef;
        }

        .section-label {
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #6c757d;
            font-weight: 700;
            margin-bottom: 0.75rem;
            display: block;
        }

        /* Column Visibility Buttons */
        .btn-toggle-col {
            font-size: 0.85rem;
            margin-right: 5px;
            margin-bottom: 5px;
            border-radius: 20px;
            padding: 5px 12px;
            border: 1px solid #dee2e6;
            background: white;
            transition: all 0.2s;
        }

        .active-col { background-color: #e7f1ff; color: #0d6efd; border-color: #0d6efd; }
        .inactive-col { opacity: 0.6; background: #f8f9fa; }

        /* Layout Positioning */
        .top-pagination-container {
            display: flex;
            justify-content: center;
            margin-bottom: 1.5rem;
        }

        .bottom-left-controls {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            margin-top: 1rem;
            gap: 0.25rem;
        }

        /* Column Search Input Styling */
        .column-search-row input {
            width: 100%;
            font-size: 0.8rem;
            padding: 4px 8px;
        }

        table.dataTable thead th {
            background-color: #212529;
            color: white;
        }

        .selected { background-color: rgba(13, 110, 253, 0.1) !important; }
    </style>
</head>
<body>

<div class="container-fluid" style="max-width: 1400px;">
    <div class="main-card">
        <div class="card-header-custom">
            <h3 class="mb-4">Data Management</h3>
            <ul class="nav nav-tabs" id="myTab" role="tablist">
                <li class="nav-item">
                    <button class="nav-link active" id="tab1-tab" data-bs-toggle="tab" data-bs-target="#tab1" type="button">Employee List A</button>
                </li>
                <li class="nav-item">
                    <button class="nav-link" id="tab2-tab" data-bs-toggle="tab" data-bs-target="#tab2" type="button">Employee List B</button>
                </li>
            </ul>
        </div>

        <div class="tab-content">
            <div class="tab-pane fade show active" id="tab1" role="tabpanel">
                <div class="controls-section">
                    <span class="section-label">Show/Hide Columns</span>
                    <div id="colVis1"></div>
                </div>

                <table id="table1" class="table table-striped table-hover w-100">
                    <thead>
                        <tr>
                            <th style="width: 30px;"><input type="checkbox" class="form-check-input" id="selectAll1"></th>
                            <th>Name</th><th>Position</th><th>Office</th><th>Nationality</th><th>Age</th><th>Start Date</th><th>Salary</th>
                        </tr>
                    </thead>
                </table>

                <div class="mt-3 border-top pt-3">
                    <button id="deleteBtn1" class="btn btn-danger btn-sm">
                        Delete Selected Rows <span id="count1" class="badge bg-white text-danger ms-1">0</span>
                    </button>
                </div>
            </div>

            <div class="tab-pane fade" id="tab2" role="tabpanel">
                <div class="controls-section">
                    <span class="section-label">Show/Hide Columns</span>
                    <div id="colVis2"></div>
                </div>

                <table id="table2" class="table table-striped table-hover w-100">
                    <thead>
                        <tr>
                            <th style="width: 30px;"><input type="checkbox" class="form-check-input" id="selectAll2"></th>
                            <th>Name</th><th>Position</th><th>Office</th><th>Nationality</th><th>Age</th><th>Start Date</th><th>Salary</th>
                        </tr>
                    </thead>
                </table>

                <div class="mt-3 border-top pt-3">
                    <button id="deleteBtn2" class="btn btn-danger btn-sm">
                        Delete Selected Rows <span id="count2" class="badge bg-white text-danger ms-1">0</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>

<script>
    const dataset = [
        { name: "Tiger Nixon", position: "System Architect", office: "Edinburgh", nationality: "Scottish", age: 61, startDate: "2011/04/25", salary: "$320,800" },
        { name: "Garrett Winters", position: "Accountant", office: "Tokyo", nationality: "Japanese", age: 63, startDate: "2011/07/25", salary: "$170,750" },
        { name: "Ashton Cox", position: "Junior Technical Author", office: "San Francisco", nationality: "American", age: 66, startDate: "2009/01/12", salary: "$86,000" },
        { name: "Cedric Kelly", position: "Senior Javascript Developer", office: "Edinburgh", nationality: "Scottish", age: 22, startDate: "2012/03/29", salary: "$433,060" },
        { name: "Airi Satou", position: "Accountant", office: "Tokyo", nationality: "Japanese", age: 33, startDate: "2008/11/28", salary: "$162,700" },
        { name: "Brielle Williamson", position: "Integration Specialist", office: "New York", nationality: "American", age: 61, startDate: "2012/12/02", salary: "$372,000" },
        { name: "Herrod Chandler", position: "Sales Assistant", office: "San Francisco", nationality: "American", age: 59, startDate: "2012/08/06", salary: "$137,500" },
        { name: "Rhona Davidson", position: "Integration Specialist", office: "Tokyo", nationality: "Japanese", age: 55, startDate: "2010/10/14", salary: "$327,900" },
        { name: "Colleen Hurst", position: "Javascript Developer", office: "San Francisco", nationality: "American", age: 39, startDate: "2009/09/15", salary: "$205,500" },
        { name: "Sonya Frost", position: "Software Engineer", office: "Edinburgh", nationality: "Scottish", age: 23, startDate: "2008/12/13", salary: "$103,600" }
    ];

    function initDataTable(tableId, visId, selectAllId, deleteBtnId, countId) {
        let selectedRows = new Set();
        const $tableEl = $(`#${tableId}`);

        // Requirement 4: Add individual column search inputs
        $tableEl.find('thead tr').clone(true).addClass('column-search-row').appendTo($tableEl.find('thead'));
        $tableEl.find('thead tr:eq(1) th').each(function (i) {
            if (i === 0) { $(this).html(''); return; }
            $(this).html('<input type="text" class="form-control form-control-sm" placeholder="Filter..." />');
        });

        const table = $tableEl.DataTable({
            data: dataset,
            searching: true, // Must be true for column search to work
            columns: [
                { 
                    data: null, orderable: false, className: 'text-center',
                    render: (data, type, row, meta) => `<input type="checkbox" class="form-check-input row-checkbox" data-index="${meta.row}">`
                },
                { data: 'name' }, { data: 'position' }, { data: 'office' }, { data: 'nationality' }, { data: 'age' }, { data: 'startDate' }, { data: 'salary' }
            ],
            // Requirement 3: Layout configuration
            dom: '<"top-pagination-container"p>t<"bottom-left-controls"li>',
            language: {
                lengthMenu: "Entries per page: _MENU_",
                info: "Showing _START_ to _END_ of _TOTAL_ entries"
            },
            drawCallback: function() {
                $(`#${tableId} .row-checkbox`).each(function() {
                    const idx = $(this).data('index');
                    if(selectedRows.has(idx)) {
                        $(this).prop('checked', true).closest('tr').addClass('selected');
                    }
                });
            }
        });

        // Requirement 4: Apply column search logic
        $tableEl.on('keyup change', '.column-search-row input', function () {
            const colIdx = $(this).parent().index();
            table.column(colIdx).search(this.value).draw();
        });

        // Requirement 5: Column Visibility
        table.columns().every(function(index) {
            if(index === 0) return;
            const title = $(this.header()).text();
            const btn = $(`<button class="btn-toggle-col active-col">${title}</button>`);
            btn.on('click', function() {
                const isVisible = !table.column(index).visible();
                table.column(index).visible(isVisible);
                $(this).toggleClass('active-col inactive-col', 200);
            });
            $(`#${visId}`).append(btn);
        });

        // Requirement 3 (Delete Logic):
        $(`#${selectAllId}`).on('change', function() {
            const isChecked = $(this).is(':checked');
            $tableEl.find('.row-checkbox').each(function() {
                const idx = $(this).data('index');
                $(this).prop('checked', isChecked).closest('tr').toggleClass('selected', isChecked);
                isChecked ? selectedRows.add(idx) : selectedRows.delete(idx);
            });
            $(`#${countId}`).text(selectedRows.size);
        });

        $tableEl.on('change', '.row-checkbox', function() {
            const idx = $(this).data('index');
            const isChecked = $(this).is(':checked');
            $(this).closest('tr').toggleClass('selected', isChecked);
            isChecked ? selectedRows.add(idx) : selectedRows.delete(idx);
            $(`#${countId}`).text(selectedRows.size);
        });

        $(`#${deleteBtnId}`).on('click', function() {
            if(selectedRows.size > 0 && confirm(`Delete ${selectedRows.size} rows?`)) {
                const indexes = Array.from(selectedRows).sort((a,b) => b-a);
                indexes.forEach(idx => table.row(idx).remove());
                selectedRows.clear();
                $(`#${selectAllId}`).prop('checked', false);
                $(`#${countId}`).text(0);
                table.draw();
            }
        });

        return table;
    }

    $(document).ready(function() {
        initDataTable('table1', 'colVis1', 'selectAll1', 'deleteBtn1', 'count1');
        initDataTable('table2', 'colVis2', 'selectAll2', 'deleteBtn2', 'count2');
        
        $('button[data-bs-toggle="tab"]').on('shown.bs.tab', function(){
            $.fn.dataTable.tables({ visible: true, api: true }).columns.adjust();
        });
    });
</script>
</body>
</html>

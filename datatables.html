<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DataTables Custom Layout</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css" rel="stylesheet">
    
    <style>
        body {
            background-color: #f8f9fa;
            font-family: "Segoe UI", system-ui, -apple-system, sans-serif;
            padding: 2rem;
        }

        .main-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            border: none;
            overflow: hidden;
        }

        .card-header-custom {
            background-color: #fff;
            border-bottom: 1px solid #eee;
            padding: 1.5rem 2rem 0;
        }

        /* Tabs Styling */
        .nav-tabs {
            border-bottom: none;
        }
        
        .nav-tabs .nav-link {
            border: none;
            color: #6c757d;
            font-weight: 500;
            padding: 10px 20px;
            border-bottom: 3px solid transparent;
        }

        .nav-tabs .nav-link:hover {
            color: #0d6efd;
            border-color: transparent;
        }

        .nav-tabs .nav-link.active {
            color: #0d6efd;
            background: transparent;
            border-bottom: 3px solid #0d6efd;
        }

        .tab-content {
            padding: 2rem;
        }

        /* Controls Section */
        .controls-section {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 1px solid #e9ecef;
        }

        .section-label {
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #6c757d;
            font-weight: 700;
            margin-bottom: 0.75rem;
            display: block;
        }

        /* Column Visibility Buttons */
        .btn-toggle-col {
            font-size: 0.85rem;
            margin-right: 5px;
            margin-bottom: 5px;
            border-radius: 20px;
            padding: 5px 12px;
            border: 1px solid #dee2e6;
            background: white;
            color: #495057;
            transition: all 0.2s;
        }

        .btn-toggle-col:hover, .btn-toggle-col.active-col {
            background-color: #e7f1ff;
            color: #0d6efd;
            border-color: #0d6efd;
        }

        .btn-toggle-col.inactive-col {
            opacity: 0.6;
            background: #f8f9fa;
        }

        /* Column Search Inputs */
        .search-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
        }

        .search-input-group input {
            font-size: 0.85rem;
            border-radius: 6px;
        }

        /* DataTables Custom Layout Styles */
        /* 1. Pagination Top Middle */
        .top-pagination-container {
            display: flex;
            justify-content: center;
            margin-bottom: 1rem;
        }

        /* 2. Length (Entries per page) Lower Left */
        .bottom-left-controls {
            display: flex;
            flex-direction: column; /* Stack vertically */
            align-items: flex-start;
            margin-top: 1rem;
            gap: 0.5rem;
        }

        /* Table Styling */
        table.dataTable thead th {
            background-color: #212529;
            color: white;
            font-weight: 500;
            padding: 12px;
        }

        table.dataTable tbody tr.selected {
            background-color: rgba(13, 110, 253, 0.1) !important;
        }

        .btn-delete {
            margin-top: 1rem;
        }

        /* Checkbox alignment */
        .select-checkbox {
            text-align: center;
        }
    </style>
</head>
<body>

<div class="container-fluid" style="max-width: 1400px;">
    <div class="main-card">
        <div class="card-header-custom">
            <h3 class="mb-4">Data Management</h3>
            
            <ul class="nav nav-tabs" id="myTab" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="tab1-tab" data-bs-toggle="tab" data-bs-target="#tab1" type="button" role="tab">Employee List A</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="tab2-tab" data-bs-toggle="tab" data-bs-target="#tab2" type="button" role="tab">Employee List B</button>
                </li>
            </ul>
        </div>

        <div class="tab-content">
            <div class="tab-pane fade show active" id="tab1" role="tabpanel">
                
                <div class="controls-section">
                    <div class="mb-3">
                        <span class="section-label">Show/Hide Columns</span>
                        <div id="colVis1"></div>
                    </div>
                    <div>
                        <span class="section-label">Column Search (Type to filter)</span>
                        <div class="search-grid" id="colSearch1"></div>
                    </div>
                </div>

                <table id="table1" class="table table-striped table-hover w-100">
                    <thead>
                        <tr>
                            <th style="width: 30px;"><input type="checkbox" class="form-check-input" id="selectAll1"></th>
                            <th>Name</th>
                            <th>Position</th>
                            <th>Office</th>
                            <th>Nationality</th>
                            <th>Age</th>
                            <th>Start Date</th>
                            <th>Salary</th>
                        </tr>
                    </thead>
                </table>

                <div class="mt-3 border-top pt-3">
                    <button id="deleteBtn1" class="btn btn-danger btn-sm">
                        Delete Selected Rows <span id="count1" class="badge bg-white text-danger ms-1">0</span>
                    </button>
                </div>
            </div>

            <div class="tab-pane fade" id="tab2" role="tabpanel">
                
                <div class="controls-section">
                    <div class="mb-3">
                        <span class="section-label">Show/Hide Columns</span>
                        <div id="colVis2"></div>
                    </div>
                    <div>
                        <span class="section-label">Column Search (Type to filter)</span>
                        <div class="search-grid" id="colSearch2"></div>
                    </div>
                </div>

                <table id="table2" class="table table-striped table-hover w-100">
                    <thead>
                        <tr>
                            <th style="width: 30px;"><input type="checkbox" class="form-check-input" id="selectAll2"></th>
                            <th>Name</th>
                            <th>Position</th>
                            <th>Office</th>
                            <th>Nationality</th>
                            <th>Age</th>
                            <th>Start Date</th>
                            <th>Salary</th>
                        </tr>
                    </thead>
                </table>

                <div class="mt-3 border-top pt-3">
                    <button id="deleteBtn2" class="btn btn-danger btn-sm">
                        Delete Selected Rows <span id="count2" class="badge bg-white text-danger ms-1">0</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>

<script>
    // Sample Data
    const dataset = [
        { name: "Tiger Nixon", position: "System Architect", office: "Edinburgh", nationality: "Scottish", age: 61, startDate: "2011/04/25", salary: "$320,800" },
        { name: "Garrett Winters", position: "Accountant", office: "Tokyo", nationality: "Japanese", age: 63, startDate: "2011/07/25", salary: "$170,750" },
        { name: "Ashton Cox", position: "Junior Technical Author", office: "San Francisco", nationality: "American", age: 66, startDate: "2009/01/12", salary: "$86,000" },
        { name: "Cedric Kelly", position: "Senior Javascript Developer", office: "Edinburgh", nationality: "Scottish", age: 22, startDate: "2012/03/29", salary: "$433,060" },
        { name: "Airi Satou", position: "Accountant", office: "Tokyo", nationality: "Japanese", age: 33, startDate: "2008/11/28", salary: "$162,700" },
        { name: "Brielle Williamson", position: "Integration Specialist", office: "New York", nationality: "American", age: 61, startDate: "2012/12/02", salary: "$372,000" },
        { name: "Herrod Chandler", position: "Sales Assistant", office: "San Francisco", nationality: "American", age: 59, startDate: "2012/08/06", salary: "$137,500" },
        { name: "Rhona Davidson", position: "Integration Specialist", office: "Tokyo", nationality: "Japanese", age: 55, startDate: "2010/10/14", salary: "$327,900" },
        { name: "Colleen Hurst", position: "Javascript Developer", office: "San Francisco", nationality: "American", age: 39, startDate: "2009/09/15", salary: "$205,500" },
        { name: "Sonya Frost", position: "Software Engineer", office: "Edinburgh", nationality: "Scottish", age: 23, startDate: "2008/12/13", salary: "$103,600" },
        { name: "Jena Gaines", position: "Office Manager", office: "London", nationality: "British", age: 30, startDate: "2008/12/19", salary: "$90,560" },
        { name: "Quinn Flynn", position: "Support Lead", office: "Edinburgh", nationality: "Scottish", age: 22, startDate: "2013/03/03", salary: "$342,000" },
        { name: "Charde Marshall", position: "Regional Director", office: "San Francisco", nationality: "American", age: 36, startDate: "2008/10/16", salary: "$470,600" },
        { name: "Haley Kennedy", position: "Senior Marketing Designer", office: "London", nationality: "British", age: 43, startDate: "2012/12/18", salary: "$313,500" },
        { name: "Tatyana Fitzpatrick", position: "Regional Director", office: "London", nationality: "British", age: 19, startDate: "2010/03/17", salary: "$385,750" }
    ];

    function initDataTable(tableId, visId, searchId, selectAllId, deleteBtnId, countId) {
        let selectedRows = new Set();
        
        // 1. Initialize DataTable with specific Layout requirements
        const table = $(`#${tableId}`).DataTable({
            data: dataset,
            columns: [
                { 
                    data: null, 
                    orderable: false, 
                    className: 'text-center',
                    render: function(data, type, row, meta) {
                        return `<input type="checkbox" class="form-check-input row-checkbox" data-index="${meta.row}">`;
                    }
                },
                { data: 'name', title: 'Name' },
                { data: 'position', title: 'Position' },
                { data: 'office', title: 'Office' },
                { data: 'nationality', title: 'Nationality' },
                { data: 'age', title: 'Age' },
                { data: 'startDate', title: 'Start Date' },
                { data: 'salary', title: 'Salary' }
            ],
            // DOM LAYOUT EXPLANATION:
            // <"top-pagination-container"p> -> Pagination in top middle
            // t -> The Table
            // <"bottom-left-controls"li> -> Length menu (l) and Info (i) stacked in bottom left
            dom: '<"top-pagination-container"p>t<"bottom-left-controls"li>',
            language: {
                lengthMenu: "Entries per page: _MENU_",
                info: "Showing _START_ to _END_ of _TOTAL_ entries"
            },
            drawCallback: function() {
                // Restore checkbox states on page change
                $(`#${tableId} .row-checkbox`).each(function() {
                    const idx = $(this).data('index');
                    if(selectedRows.has(idx)) {
                        $(this).prop('checked', true);
                        $(this).closest('tr').addClass('selected');
                    }
                });
            }
        });

        // 2. Generate Column Visibility Toggles
        table.columns().every(function(index) {
            // Skip the checkbox column (index 0)
            if(index === 0) return;

            const header = this.header();
            const title = $(header).text();
            const btn = $(`<button class="btn-toggle-col active-col">${title}</button>`);

            btn.on('click', function() {
                const col = table.column(index);
                const isVisible = !col.visible();
                col.visible(isVisible);
                
                if(isVisible) {
                    $(this).addClass('active-col').removeClass('inactive-col');
                } else {
                    $(this).removeClass('active-col').addClass('inactive-col');
                }
            });

            $(`#${visId}`).append(btn);
        });

        // 3. Generate Individual Column Search (Input Fields)
        table.columns().every(function(index) {
            if(index === 0) return; // Skip checkbox

            const header = this.header();
            const title = $(header).text();
            
            const wrapper = $(`<div class="search-input-group"></div>`);
            const input = $(`<input type="text" class="form-control" placeholder="${title}">`);

            input.on('keyup change clear', function() {
                if (table.column(index).search() !== this.value) {
                    table.column(index).search(this.value).draw();
                }
            });

            wrapper.append(input);
            $(`#${searchId}`).append(wrapper);
        });

        // 4. Row Selection Logic
        function updateCounter() {
            $(`#${countId}`).text(selectedRows.size);
        }

        // Handle "Select All"
        $(`#${selectAllId}`).on('change', function() {
            const isChecked = $(this).is(':checked');
            const rows = table.rows({ search: 'applied' }).nodes();
            
            $(rows).each(function() {
                const checkbox = $(this).find('.row-checkbox');
                const idx = checkbox.data('index');
                checkbox.prop('checked', isChecked);
                
                if(isChecked) {
                    selectedRows.add(idx);
                    $(this).addClass('selected');
                } else {
                    selectedRows.delete(idx);
                    $(this).removeClass('selected');
                }
            });
            updateCounter();
        });

        // Handle Individual Checkbox
        $(`#${tableId} tbody`).on('change', '.row-checkbox', function() {
            const idx = $(this).data('index');
            const isChecked = $(this).is(':checked');
            const row = $(this).closest('tr');

            if(isChecked) {
                selectedRows.add(idx);
                row.addClass('selected');
            } else {
                selectedRows.delete(idx);
                row.removeClass('selected');
                $(`#${selectAllId}`).prop('checked', false);
            }
            updateCounter();
        });

        // 5. Delete Functionality
        $(`#${deleteBtnId}`).on('click', function() {
            if(selectedRows.size === 0) return;

            if(confirm(`Delete ${selectedRows.size} rows?`)) {
                // Convert Set to Array and sort descending to avoid index shifting issues
                const indexes = Array.from(selectedRows).sort((a,b) => b-a);
                
                indexes.forEach(idx => {
                    // Note: In a real scenario with server-side data, you'd use row ids.
                    // For client-side, we remove by index.
                    table.row(idx).remove();
                });
                
                selectedRows.clear();
                $(`#${selectAllId}`).prop('checked', false);
                updateCounter();
                table.draw();
            }
        });

        return table;
    }

    $(document).ready(function() {
        const table1 = initDataTable('table1', 'colVis1', 'colSearch1', 'selectAll1', 'deleteBtn1', 'count1');
        const table2 = initDataTable('table2', 'colVis2', 'colSearch2', 'selectAll2', 'deleteBtn2', 'count2');

        // Fix column alignment when switching tabs
        $('button[data-bs-toggle="tab"]').on('shown.bs.tab', function(){
            $.fn.dataTable.tables({ visible: true, api: true }).columns.adjust();
        });
    });
</script>

</body>
</html>
